(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.removeAttribute("disabled"),t.classList.remove(r.inactiveButtonSelector)):(t.setAttribute("disabled",""),t.classList.add(r.inactiveButtonSelector))}e.d({},{Z:()=>C});var r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-6",headers:{authorization:"66513836-3591-419e-b6c4-3871ea4b7d14","Content-Type":"application/json; charset=UTF-8"}};function n(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var o=fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then(n),c=fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then(n),a=Array.from(document.querySelectorAll(".pop-up")),i=Array.from(document.querySelectorAll(".pop-up__close-button")),u=document.querySelector(".pop-up_type_profile"),l=document.querySelector(".profile"),s=l.querySelector(".profile__name"),d=l.querySelector(".profile__occupation"),f=l.querySelector(".profile__edit-button"),m=document.querySelector(".form_type_profile-info"),_=m.querySelector(".form__item_name"),v=m.querySelector(".form__item_occupation"),p=m.querySelector(".form__save-button"),y=document.querySelector(".pop-up_type_avatar"),h=l.querySelector(".profile__edit-avatar-button"),b=document.querySelector(".form_type_profile-avatar"),S=b.querySelector(".form__item_avatar"),q=l.querySelector(".profile__avatar"),E=b.querySelector(".form__save-button");function L(e){e.querySelector(".form__save-button").textContent="Сохранение..."}function g(e){"Escape"===e.key&&a.forEach((function(e){e.classList.contains("pop-up_opened")&&A(e)}))}function k(e){e.classList.add("pop-up_opened"),window.addEventListener("keydown",g)}function A(e){e.classList.remove("pop-up_opened"),window.removeEventListener("keydown",g)}var C,x,w=document.querySelector(".form_type_new-card"),U=w.querySelector(".form__item_heading"),O=w.querySelector(".form__item_image"),T=w.querySelector(".form__save-button"),j=document.querySelector(".pop-up_type_new-card"),P=document.querySelector(".cards"),D=document.querySelector(".profile__add-button"),B=document.querySelector(".pop-up_type_card"),I=B.querySelector(".pop-up__image"),N=B.querySelector(".pop-up__caption");function J(e,t){var o=function(e,t,o){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image"),i=c.querySelector(".card__like-button");a.setAttribute("src",e),a.setAttribute("alt",t),c.querySelector(".card__title").textContent=t;var u=c.querySelector(".card__like-number");if(u.textContent=o.likes.length,o.likes.find((function(e){return e._id==C}))&&i.classList.add("card__like-button_active"),i.addEventListener("click",(function(){i.classList.contains("card__like-button_active")?function(e,t,o){(function(e,t,o){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e._id),{method:"DELETE",headers:r.headers}).then(n)})(e).then((function(e){var r=e.likes.length;o.textContent=r,t.classList.remove("card__like-button_active")})).catch((function(e){console.log(e)}))}(o,i,u):function(e,t,o){(function(e,t,o){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e._id),{method:"PUT",body:JSON.stringify(e.owner),headers:r.headers}).then(n)})(e).then((function(e){var r=e.likes.length;o.textContent=r,t.classList.add("card__like-button_active")})).catch((function(e){console.log(e)}))}(o,i,u)})),a.addEventListener("click",(function(){I.src=e,I.alt=t,N.textContent=t,k(B)})),o.owner._id==C){var l=document.createElement("button");l.classList.add("card__trash-button"),l.setAttribute("type","button"),l.addEventListener("click",(function(){!function(e,t){(function(e,t){return fetch("".concat(r.baseUrl,"/cards/").concat(e._id),{method:"DELETE",headers:r.headers}).then(n)})(e).then((function(){t.remove()})).catch((function(e){console.log(e)}))}(o,c)})),c.appendChild(l)}return c}(e.link,e.name,e);T.classList.add("form__save-button_inactive"),T.setAttribute("disabled",""),t.prepend(o)}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}a.forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("pop-up")&&A(e.target)}))})),i.forEach((function(e){e.addEventListener("click",(function(t){A(e.closest(".pop-up"))}))})),m.addEventListener("submit",(function(e){e.preventDefault(),L(m),function(e,t){return fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",body:JSON.stringify({name:e.value,about:t.value}),headers:r.headers}).then(n)}(_,v).then((function(e){s.textContent=e.name,d.textContent=e.about,p.classList.remove("form__save-button_inactive"),p.removeAttribute("disabled")})).then((function(){return A(u)})).catch((function(e){console.log(e)})).finally((function(){p.textContent="Сохранить"}))})),f.addEventListener("click",(function(){k(u)})),b.addEventListener("submit",(function(e){e.preventDefault(),L(b),function(e){return fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:e.value}),headers:r.headers}).then(n)}(S).then((function(e){q.src=e.avatar,b.reset(),E.classList.add("form__save-button_inactive"),E.setAttribute("disabled","")})).then((function(){return A(y)})).catch((function(e){console.log(e)})).finally((function(){E.textContent="Сохранить"}))})),h.addEventListener("click",(function(){k(y)})),w.addEventListener("submit",(function(e){var t,o;e.preventDefault(),L(w),(t=U,o=O,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",body:JSON.stringify({name:t.value,link:o.value}),headers:r.headers}).then(n)).then((function(e){J(e,P),w.reset()})).then((function(){return A(j)})).catch((function(e){console.log(e)})).finally((function(){T.textContent="Сохранить"}))})),D.addEventListener("click",(function(){k(j)})),Promise.all([c,o]).then((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c=[],a=!0,i=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(c.push(n.value),!t||c.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(i)throw o}}return c}}(t,r)||function(e,t){if(e){if("string"==typeof e)return H(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?H(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],c=n[1];C=o._id,c.forEach((function(e){return J(e,P)})),s.textContent=o.name,d.textContent=o.about,q.src=o.avatar,_.value=o.name,v.value=o.about,p.classList.remove("form__save-button_inactive"),p.removeAttribute("disabled")})).catch((function(e){console.log(e)})),x={formSelector:".form",formInputSelector:".form__item",itemErrorSelector:"form__item_type_error",activeErrorSelector:"form__item-error_active",saveButtonSelector:".form__save-button",inactiveButtonSelector:"form__save-button_inactive"},Array.from(document.querySelectorAll(x.formSelector)).forEach((function(e){!function(e,r){var n=Array.from(e.querySelectorAll(r.formInputSelector)),o=e.querySelector(r.saveButtonSelector);t(n,o,r),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,r){t.validity.valid?function(e,t,r){var n=e.querySelector(".".concat(t.name,"-error"));t.classList.remove(r.itemErrorSelector),n.classList.remove(r.activeErrorSelector),n.textContent=""}(e,t,r):function(e,t,r,n){var o=e.querySelector(".".concat(t.name,"-error"));t.classList.add(n.itemErrorSelector),o.textContent=r,o.classList.add(n.activeErrorSelector)}(e,t,t.validationMessage,r)}(e,c,r),t(n,o,r)}))}))}(e,x),e.addEventListener("submit",(function(e){e.preventDefault()}))}))})();